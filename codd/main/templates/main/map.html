<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ЦОДД</title>
    <title>API карт 2ГИС</title>

</head>

<body>
    <div id="container" style="width: 500px; height: 500px;"></div>
    <script src="https://mapgl.2gis.com/api/js/v1"></script>
    <script src="https://cdn.jsdelivr.net/npm/kdbush"></script>
    <script>

        const map = new mapgl.Map('container', {
            center: [38.975313, 45.035470],
            zoom: 12,
            trafficControl: 'topLeft',
            key: 'e62bd2eb-fe90-4a50-855f-1765b1513a2c',
            style: '0edd80fc-842c-4e1b-a9b3-3c9dc6160176',
        });
        map.setMinZoom(11);
        map.setMaxZoom(20);
        map.showTraffic();
        // manually collected points
        // const points = [];
        // map.on('click', function(e){
        //     points.push(e.lngLat)
        //     console.log(points.length)

        //     if(points.length > 100){
        //         console.log(JSON.stringify(points))
        //     }
        // })


        //console.log(points)
        // i = 0;
        // const pointCluster = new Map();
        // while (i < points.length) {
        //     const closestPoints = [];
        //     j = 0
        //     while (j < )
        //         const difference = 1500;

        //     pointCluster.set(points[i], closestPoints)
        // }
        // const test = [[39.01116214871298, 45.12701954130559], [39.01124797954017, 45.12296209291248]]
        // console.log(Math.sqrt(((111000 * Math.abs(45.12296209291248 - 45.12701954130559)) ** 2) + ((84000 * Math.abs(39.01124797954017 - 39.01116214871298)) ** 2)));
        const points = [[39.01116214871298, 45.12701954130559], [39.01124797954017, 45.12296209291248], [39.01124797965797, 45.11920718271892], [39.011677133177024, 45.11527031862753], [39.01236377864345, 45.110666872386496], [39.01262127084468, 45.106789995057206], [39.01279293232114, 45.10218586212206], [39.01339374720141, 45.09739959445573], [39.01390873128168, 45.093158263353146], [39.01416622326694, 45.08970437590493], [39.01450954600623, 45.086068476388476], [39.01459537661034, 45.0827959694907], [39.015196191313514, 45.07849294436811], [39.015367852536954, 45.07515939283502], [39.015711175217604, 45.07140133624747], [39.015968667153444, 45.067824892201216], [39.01674114324622, 45.06503632332461], [39.016826973671066, 45.061095722909954], [39.016998634677606, 45.056063485414555], [39.01725612656944, 45.05175844687911], [39.017599449196474, 45.04872653564568], [39.02189098333148, 45.04611896375766], [39.02686916232298, 45.04326869143565], [39.027212484074944, 45.03956919056231], [39.02566753577077, 45.056245381238064], [39.0254100445179, 45.06006505917358], [39.022234309398385, 45.05970129128709], [39.02197681783937, 45.0634601147631], [39.025066722471536, 45.06352073892738], [39.021719326125385, 45.06630938119088], [39.02111851158721, 45.06909788775451], [39.024723400790045, 45.069340360173506], [39.02463757063831, 45.07237117883337], [39.0212901733996, 45.0730379374208], [39.023865094848944, 45.075523060161245], [39.02041265942702, 45.07879598122283], [39.02058432100027, 45.08194750726691], [39.02479002513143, 45.08291717270319], [39.0198976756226, 45.085523067208406], [39.0252191792172, 45.086674471193845], [39.02624914802324, 45.088734820546875], [39.01955435299354, 45.089704371061615], [39.01929686099276, 45.0931582596195], [39.0190393689153, 45.09709665018671], [39.01861021537783, 45.10097418539762], [39.01835272326545, 45.10466971491533], [39.01800940042026, 45.10781981395019], [39.018009400345164, 45.11121203436614], [39.0202409982237, 45.114785762027765], [39.026420808066476, 45.11169662068898], [39.02530500732994, 45.09521837602104], [39.03225729369545, 45.095400147312894], [39.034231399154855, 45.09261292409626], [39.040582871495594, 45.09630899510835], [39.034317229366266, 45.09018914142894], [39.04178450000091, 45.092794703660914], [39.04453108310149, 45.095157785463215], [39.044702742528315, 45.09049211987336], [39.039123747432235, 45.08897721161556], [39.03114149380164, 45.08885601722491], [39.03423139908101, 45.08328079610564], [39.02753660488458, 45.08279596852553], [39.023073409628935, 45.077765640202315], [39.0295107110094, 45.077886858129325], [39.03672048856366, 45.077765640202315], [39.03423139832083, 45.07243179753621], [39.02418920910121, 45.07388653115433], [39.02477341358193, 45.06891603696912], [39.02932244013989, 45.0691585101318], [39.03584557262403, 45.069279746331475], [39.04262619718194, 45.069279746331475], [39.034300619956575, 45.066491248879466], [39.025545890102094, 45.06588503582524], [39.03842049278701, 45.066066900413], [39.044171148767234, 45.06643062786325], [39.03481560384348, 45.06412698169854], [39.029837424384425, 45.0600044363868], [39.03000908597886, 45.056124121385594], [39.03498726605842, 45.056124121385594], [39.04082375332, 45.057458009558864], [39.04657440990181, 45.05782179185439], [39.034558110059635, 45.05254672098418], [39.03181152768113, 45.05163717701326], [39.027348330778246, 45.04041828165575], [39.023142627017336, 45.03708250847537], [39.0182502780749, 45.035626838089925], [39.019537738204555, 45.04084281932815], [39.015246203357194, 45.04338998661773], [39.00777893351536, 45.04078217110979], [39.004002382422115, 45.04272288230744], [39.008465577973816, 45.0449667477706], [39.01292877400418, 45.04690731737456], [39.00614815019863, 45.041388650413786], [39.01026802418152, 45.03793163247017], [39.01224213050918, 45.03477767997463], [39.016791156572246, 45.03453506106425], [39.010010532575144, 45.035262914760814], [39.00700645883477, 45.03556618436929], [39.003744892984734, 45.03611206562495], [38.9989383746577, 45.037264464549764], [38.999367527837, 45.03817423682087], [39.00280075528083, 45.0374464201596], [39.008208088245325, 45.036961203919546], [39.00528984476372, 45.039751141245155], [39.00168495587695, 45.04017568503045], [38.997221759995895, 45.040782170698535], [38.99481850114037, 45.0396298424454], [38.99310188819563, 45.03762837518911], [38.994818500657125, 45.04102476316761], [38.99524765321796, 45.043632567437754], [38.99576263666432, 45.04581575423677], [38.99988251024614, 45.045269965328856], [39.002543262152614, 45.04345063145183], [38.99911003345941, 45.04854461988005], [38.99456100651467, 45.04909037751512], [38.991814424276185, 45.04909037751512], [38.99044113177627, 45.05260735768965], [38.990355300190906, 45.05485083578051], [38.99576263457527, 45.05509336869423], [38.99979667776844, 45.05503273556278], [39.004259874435384, 45.05545716613931], [39.008208086964856, 45.05345625161651], [39.0082939176976, 45.05036379180111], [39.00237159778045, 45.05921626457453], [39.001513290739226, 45.06267199653917], [39.00820808498127, 45.06279324650732], [38.99464683523019, 45.06206574284442], [38.98675041151818, 45.06164136144358], [38.985033798398206, 45.05976192031618], [38.988896179982774, 45.058064307617514], [38.985548781838986, 45.065945652188404], [38.986235426798004, 45.06788550924192], [38.98632125664407, 45.071158869112814], [38.98692207088264, 45.07364407300709], [38.988209530586055, 45.077098933449726], [38.988037868581536, 45.079826307674274], [38.98958282065834, 45.083402001571926], [38.99516181712691, 45.083038381881764], [39.00099830560422, 45.081947508956], [39.0080364238725, 45.081462669874284], [39.00863723787304, 45.077098933449726], [39.00142745889003, 45.07794746379109], [38.994303510372696, 45.07849294094469], [38.993531034539764, 45.073401618832705], [39.00048332089946, 45.07291670741508], [39.00786476059784, 45.07249240655429], [39.008208082518124, 45.06849170110319], [39.00082664342591, 45.06830984422006], [38.9923294054659, 45.06818860597902], [38.9919860832204, 45.06467258529978], [39.00116996599702, 45.064793830985074], [39.00889472738525, 45.06552129970057], [39.00958137193835, 45.06170198592432], [39.00228576466878, 45.062611369433114], [38.9869220738251, 45.061762611939855], [38.98666458227771, 45.059943803555086], [38.990487195933255, 45.09055271391019], [38.99194631727911, 45.09443069312675], [38.992976285237546, 45.099096038740846], [38.99615202162999, 45.0975207697555], [38.99546537618683, 45.09291588876026], [39.001731017197116, 45.091461638856075], [39.00190267888792, 45.094794240209964], [39.004735092133544, 45.094915422060076], [39.009112457912266, 45.094370101722276], [38.998898605346554, 45.098974863843495], [38.99252380678022, 45.10012599643696], [38.99312462127314, 45.10164060931379], [38.9932962821022, 45.10400332537086], [38.99484123462101, 45.10448797302199], [39.00110687569671, 45.10672941499857], [39.00754417860481, 45.106123628523875], [39.00522674948849, 45.10224644324172], [38.9956995425681, 45.110727443150225], [39.00290932051039, 45.11078801718129], [39.004110950121195, 45.11418006043148], [38.99630035667747, 45.1146646216191], [38.9975019859635, 45.11769303607091], [39.00402511936039, 45.11799586869758], [39.0003343988156, 45.12120579597334], [39.00471176486228, 45.12399162335393], [39.01140655939122, 45.12647452913635], [38.99638618627784, 45.12756455127529], [38.99054969932046, 45.125263369052966], [38.98617233295391, 45.12278041015364], [38.985829009872035, 45.11860152863783], [38.99183715882889, 45.119631136485076], [38.98574317904741, 45.11648168941173], [38.99200881966922, 45.1167845283962], [38.985142364042396, 45.11321092621951], [38.99063552799299, 45.11327149760706], [38.98436988778934, 45.11078801810236], [38.98994888195995, 45.10969767597074], [38.98342888776418, 45.10775923865453], [38.98737709857299, 45.10503319981873], [38.98274224199623, 45.103942747922595], [38.97484582006608, 45.10345809596521], [38.980682305638695, 45.10067126674352], [38.9797381680165, 45.098308413598076], [38.97759240103906, 45.093945966910674], [38.98523133147603, 45.09703606765716], [38.9839438708591, 45.09352182241257], [38.977249078381284, 45.092431150717175], [38.97141259183519, 45.09849017499345], [38.97252839123047, 45.09430951683161], [38.96420281415062, 45.09970190289496], [38.96471779676836, 45.104790879954216], [38.97287171283513, 45.10357925979148], [38.97578995625457, 45.10503320090793], [38.9607695839719, 45.107153465475776], [38.9673785474245, 45.1084255865054], [38.96823685381037, 45.11127261205043], [38.950481293043126, 45.10818327954369], [38.94455897491064, 45.106850574804135], [38.94627558998463, 45.10406391004735], [38.94524562259794, 45.101519445455644], [38.95159709409802, 45.100671265452696], [38.95271289288759, 45.09703606569539], [38.948678850644384, 45.09388537251341], [38.94292819380172, 45.10224644695004], [38.93709170796204, 45.108970769674855], [38.93219935887497, 45.10576015553729], [38.92799365432984, 45.111636048337324], [38.92395961118094, 45.11345321259981], [38.92250049007483, 45.110788018592324], [38.91880977167703, 45.10691115113415], [38.916835667182, 45.10376100290327], [38.914604069613674, 45.10067126451879], [38.909625890658404, 45.0963695862769], [38.925676229400395, 45.10242819503549], [38.935804251981324, 45.10285227363325], [38.92516124516603, 45.098126648840925], [38.93460262080979, 45.0963695862769], [38.927993657419556, 45.09024974047739], [38.92301547818044, 45.09024974047739], [38.90653598531544, 45.09273411248138], [38.903274419362376, 45.08873482474013], [38.900442007223056, 45.085765475885154], [38.898553732703505, 45.083523212469096], [38.90687931000956, 45.082553557384855], [38.911685827911015, 45.087098673562764], [38.91563403958241, 45.093158267335774], [38.921298865173284, 45.096006053265256], [38.92490375392794, 45.10121652913287], [38.92807948991973, 45.104548561545435], [38.89687868916559, 45.081734450771464], [38.89430376883631, 45.07834048000785], [38.89945361118872, 45.075188754217315], [38.89284464755965, 45.073552212767424], [38.89705035178649, 45.07197623977732], [38.906491727896814, 45.070521457002236], [38.900655240889364, 45.06943034567887], [38.892072171872755, 45.07009713839966], [38.89052722025919, 45.066096265672044], [38.89756533629028, 45.06542942638948], [38.90331599205626, 45.06676309719169], [38.908380002791674, 45.068824163743884], [38.912585705876324, 45.06652061390283], [38.90666338830285, 45.0637319822997], [38.90014025673111, 45.06312574007907], [38.89353129457232, 45.06312574007907], [38.88975474524354, 45.06094321499679], [38.89464709409771, 45.05682044084568], [38.88400409145571, 45.05706296518107], [38.884004091538856, 45.05682044084568], [38.90220019264489, 45.05597159759291], [38.90400263694197, 45.059973177165], [38.90958163112261, 45.06251949144854], [38.91061159998587, 45.06579315787033], [38.91558977925473, 45.06488382484253], [38.91910883618946, 45.06251949144854], [38.916448084493965, 45.06045819813149], [38.91464564077514, 45.05791179035569], [38.9094957991961, 45.054940838748706], [38.90443178843185, 45.05621412257656], [38.89919611621908, 45.05657791276407], [38.89387461329724, 45.05675980698894], [38.918679682947136, 45.05568662257299], [38.92657610536366, 45.05883942246038], [38.93447252804034, 45.055322826813125], [38.93198343746633, 45.05089645780143], [38.93781992387032, 45.04665167343003], [38.93052431557368, 45.046045250011424], [38.935330833601654, 45.043619492203504], [38.93009516210928, 45.04319497403947], [38.926318612357136, 45.04113298396263], [38.9232287081476, 45.040344556403575], [38.91833635983772, 45.03985936482402], [38.91086909179911, 45.038525066818806], [38.91850802130094, 45.04246722180307], [38.924601999674266, 45.046287821158955], [38.90949580066771, 45.03828246358565], [38.905719251475055, 45.0347039494068], [38.90426013046057, 45.032944936876454], [38.90228602600666, 45.02973005048864], [38.903315994694225, 45.027546251335814], [38.906062575803055, 45.028152870550976], [38.90940997151343, 45.02954807039931], [38.91498896482641, 45.03148916158418], [38.9180788690196, 45.033066249815455], [38.92237040287231, 45.034279365112404], [38.926232783574456, 45.035613762309254], [38.93181177857454, 45.038403765240844], [38.93584582150103, 45.04034455680554], [38.936017483173195, 45.042891745451705], [38.933185070744734, 45.04392271821587], [38.93687579031521, 45.04507495995626], [38.93430086989495, 45.046772958226065], [38.937905759028716, 45.047925142704294], [38.938764066545794, 45.05113900861563], [38.943398924343434, 45.05168474153879], [38.9430556011111, 45.05010816558725], [38.94202563215933, 45.04774322037778], [38.93970820345411, 45.04750065637585], [38.94185397031474, 45.045923965377504], [38.938935726708195, 45.04471109664442], [38.94133898583507, 45.04446851982268], [38.938935726371135, 45.04295239142386], [38.94168230810136, 45.04258851463839], [38.94005152476695, 45.040769096111916], [38.94151064584226, 45.03894961986186], [38.944772211875, 45.040223259297534], [38.94846293096469, 45.03846441632017], [38.954127755323775, 45.037008781353286], [38.954814401478636, 45.04040520549022], [38.95120951306506, 45.041496870535006], [38.95249697370928, 45.043880507362594], [38.956702677199296, 45.04345599107905], [38.9567026778913, 45.04606368433571], [38.95275446627748, 45.046730749612635], [38.94803377834187, 45.04770101252576], [38.949063746829616, 45.04952021123323], [38.95284029742038, 45.049277654739726], [38.957732646870014, 45.04854997910268], [38.959105938679144, 45.05079361598913], [38.95129534535888, 45.05249144500144], [38.94477221203387, 45.05321907061363], [38.951552836845366, 45.034419107512825], [38.94932123898955, 45.0316895683705], [38.93404338695691, 45.058797216616455], [38.93593166172188, 45.062556099097755], [38.92786357799642, 45.06201047016178], [38.929065206977484, 45.065344788089384], [38.92279956651412, 45.06716342519108], [38.928807714049, 45.070861142643075], [38.93610332306523, 45.07061867667814], [38.940480688251185, 45.068436436822985], [38.94314143878318, 45.06273797425644], [38.94717548158417, 45.06643597727773], [38.947604633944174, 45.06207109585494], [38.94563052758634, 45.05831218156812], [38.94659284116306, 45.07274021907826], [38.93303159085343, 45.073043290150515], [38.954832587974636, 45.072073457073344], [38.954575094614974, 45.06704218451454], [38.95002606775754, 45.06425357812279], [38.94736531617536, 45.05976727440321], [38.95679071384937, 45.05963913388455], [38.9530999941722, 45.053757890471466], [38.96056726388582, 45.05503120052904], [38.9606530949162, 45.057820257072215], [38.96159723291269, 45.060487923310646], [38.957649020927704, 45.061761083883425], [38.95404413152619, 45.06333733873853], [38.95867898953525, 45.06442856670892], [38.96271303280786, 45.065459151819006], [38.96563127727531, 45.06745964648173], [38.97043779687523, 45.07049056467501], [38.97284105550545, 45.067823365134615], [38.97927835817258, 45.068914507424445], [38.98185327972362, 45.0717028877645], [38.97979334313605, 45.074794194297326], [38.979965004547026, 45.07467296973077], [38.98365572318318, 45.065034795991565], [38.97567346849032, 45.06430732085699], [38.97060945762145, 45.06327671527123], [38.967948706213285, 45.0629129676996], [38.96983698169229, 45.05982102011635], [38.973785193232246, 45.06030604253588], [38.97790506611411, 45.059457250612134], [38.98253992243931, 45.05588006084088], [38.98090914008864, 45.059457250612134], [38.976188452282884, 45.05678953702954], [38.97129610353893, 45.05636511660506], [38.970094473792884, 45.05927536499271], [38.975587637453124, 45.05497057021978], [38.97661760553104, 45.051938829489416], [38.97155359499804, 45.05175691995093], [38.97018030412164, 45.04975587690535], [38.97567346774298, 45.04854308955607], [38.97936418777355, 45.05387916201926], [38.98133829349391, 45.05303027462285], [38.98030832472925, 45.04999843129758], [38.97807672669886, 45.047694123147906], [38.977935523021515, 45.043388457130476], [38.97621890960873, 45.043509747923785], [38.97398731214473, 45.0429639373416], [38.96823665722389, 45.04308522902961], [38.96883747169179, 45.04563229525264], [38.9699532702311, 45.049331404249145], [38.96325847684683, 45.05024098466059], [38.96179935609499, 45.04660257643573], [38.96102688057022, 45.042833694167406], [38.964975092445464, 45.04174205442503], [38.96900913479418, 45.04149946499735], [38.97175571678591, 45.04113557892974], [38.97587558967872, 45.04046844847574], [38.98016712439165, 45.040468448475735], [38.98342869090015, 45.03949806284349], [38.98746273348936, 45.03877026284853], [38.99072429973902, 45.03804245361567], [38.991668437518165, 45.04071104231858], [38.98806354830976, 45.041378170093296], [38.98274204499319, 45.04246981698889], [38.98119709200854, 45.045138199701796], [38.98806354826819, 45.047018122063605], [38.983857843352126, 45.04986820938482], [38.985574456468036, 45.05399148723536], [38.97896549374137, 45.037496589562046], [38.984887812284796, 45.036586806051574], [38.98943683931087, 45.03531308490061], [38.99312755926355, 45.03464588634439], [38.99192592885198, 45.03203767207463], [38.98179790690258, 45.03306884072634], [38.97681972644114, 45.03373605762559], [38.972614022255556, 45.03367540186506], [38.969867440514165, 45.031188460438926], [38.97518894355648, 45.030642532037916], [38.97982380095803, 45.02955065965221], [38.983943674101184, 45.02979329975614], [38.98909351536684, 45.02882273318703], [38.99226925161031, 45.031916356894214], [38.985316964807815, 45.02621425417705], [38.98068210786717, 45.02724552749036], [38.976819726955895, 45.027791488216224], [38.97252819249107, 45.028458766488264], [38.96720668950709, 45.02955065965221], [38.9611127105985, 45.03021791742404], [38.961627695226944, 45.02724552764439], [38.96703502831368, 45.02627491803657], [38.97269985320452, 45.02518296261212], [38.978021355198315, 45.02451564629009], [38.983943672062985, 45.02475830766951], [38.98883602036015, 45.02384832220827], [38.98291370304394, 45.02172496668156], [38.98093959689264, 45.018994822713495], [38.97613307961949, 45.019904885131126], [38.97106907015186, 45.0209969409837], [38.96737835125676, 45.02136095499011], [38.962743494840254, 45.02214964406979], [38.95909717766676, 45.01950737287238], [38.96716526195425, 45.01865797554943], [38.970770150529894, 45.01774789303495], [38.976005821793834, 45.016473753278426], [38.978409080872325, 45.01489620735415], [38.97343090108356, 45.013439972642686], [38.97154262610893, 45.01119487176512], [38.97077014985925, 45.01483553164612], [38.970512657814304, 45.014592828169576], [38.96673610758877, 45.01526026025872], [38.95866802279101, 45.01623105672147], [38.95969799193744, 45.013015230562715], [38.96029880676012, 45.00901036341375], [38.96587780165213, 45.00822149300592], [38.97171428934757, 45.01077011219917], [38.96647861592233, 45.004762471722806], [38.96098545215647, 45.005915501969284], [38.9620154200854, 45.00130324208647], [38.97962258287496, 45.013343798664394], [38.98614571589018, 45.014678684457564], [38.98540187443561, 45.019262931711616], [38.98995090126915, 45.02011232025805], [38.98823428781523, 45.02350974874821], [38.98239780020071, 45.02229640451814], [38.98377109106759, 45.02575436682029], [38.98076701681679, 45.02769558755015], [38.98900676326873, 45.02878749535222], [38.98428607506379, 45.032851636226695], [38.99329829869726, 45.03315491877795], [38.98737598044074, 45.03600569639743], [38.997160680711225, 45.03491392595959], [39.00454212077416, 45.03364016752644], [39.0009372305805, 45.03157783200128], [38.99398494390385, 45.03103190725065], [39.00419879727619, 45.03006136160815], [39.00677371775828, 45.027088962665694], [38.999048954970064, 45.02775624930259], [39.004799611393295, 45.02520838585685], [38.99776149443729, 45.02478373094616], [38.99638820335781, 45.02357041390045], [39.003340488912734, 45.020172989700484], [38.99638820341324, 45.0198089680343], [38.99424243637067, 45.018595545814755], [38.997246510173, 45.01610794933169], [38.995529896622976, 45.01234601340141], [39.00479961126448, 45.019323602353666], [39.00282550499628, 45.01635064641088], [39.0048854410283, 45.012588726384934], [39.00248218180096, 45.011314471775], [39.00969195903034, 45.01161786829436], [39.01140857366308, 45.01525850147881], [39.01072192916952, 45.019080917844036], [39.01046443760235, 45.02108303435815], [39.01089359274693, 45.02727095295903], [39.01604343444016, 45.028666175318534], [39.02093578406456, 45.031335201060116], [39.02102161414197, 45.027938237658525], [39.027716407252996, 45.026846313854875], [39.024798163674305, 45.02521574401587], [39.01827503208612, 45.02442709710224], [39.01990581445233, 45.02139373873856], [39.019991645128485, 45.021393738732286], [39.02145076729999, 45.018542232894234], [39.01501346455184, 45.01666137491289], [39.02290988928177, 45.01508383360417], [39.013296851233825, 45.01277811831895], [39.02162242884531, 45.010532990773214], [39.01570011105271, 45.01059367104974], [39.01381183649849, 45.006892056782284], [39.023339042614616, 45.00652795068318], [39.014755974619476, 45.00337226780229], [39.022394905077896, 45.002704697280436], [39.026858100594175, 45.0053749328124], [39.032351264681786, 45.00713479289802], [39.036127814681116, 45.00646726610992], [39.0407626731768, 45.010290269022676], [39.030977974741376, 45.01277811831895], [39.026171455886384, 45.01471977945382], [39.027373086106046, 45.018602904705546], [39.03183628259196, 45.01714676351836], [39.02359653502288, 45.0202410193885], [39.03526951029113, 45.0179680761165], [39.04213596583371, 45.016754614574545], [39.0467708230502, 45.015541127380445], [39.04986072763094, 45.01432761453418], [39.04917408302061, 45.01821076534726], [39.049603237378406, 45.02185098067512], [39.03501201764023, 45.025794286746795], [39.02891803687348, 45.027553520506665], [39.02814555998218, 45.03076853056916], [39.033724555016235, 45.03137511604678], [39.041792640371675, 45.03186037981275], [39.043337592456666, 45.027978154769635], [39.03793025907321, 45.02846344726601], [39.041449317272146, 45.02749285817204], [39.03595615291569, 45.03319483394965], [39.036642798279296, 45.03622756838102], [39.03011966558995, 45.0352571108081], [39.04505420654767, 45.036894748442], [39.05166317028255, 45.037137357449055], [39.05818630336003, 45.03731931352864], [39.05741382607569, 45.03477187586353], [39.045966482784586, 45.03283089504806], [39.0516313083319, 45.03301286479054], [39.05068717007201, 45.02979798105157], [39.04982886258933, 45.026400927037564], [39.0567811489592, 45.03076853097541], [39.056781147745944, 45.027189546787355], [39.04382071498326, 45.023549672905645], [39.048798893685394, 45.021790317767035], [39.05420622618397, 45.023003671910764], [39.05712446947533, 45.02433833183594], [39.049312717036386, 45.020943245177925], [39.04811108790188, 45.01760633760314], [39.05214513075106, 45.01281298545584], [39.05592168069317, 45.01305569645022], [39.066650515697575, 45.012448917031186], [39.07918179549136, 45.013480438252756], [39.073946123758034, 45.01627152042162], [39.0780659971332, 45.019911858446264], [39.08081257991305, 45.02355196560458], [39.0796967814029, 45.02882971089805], [39.08776486788911, 45.02725250453522], [39.094459661127324, 45.02245995769588], [39.092142231491245, 45.02057922870979], [39.086906558512595, 45.01888045277795], [39.08690655723899, 45.014208559725326], [39.093687181956604, 45.015604100075386], [39.09969533030803, 45.01313556743545], [39.101755266234996, 45.00955548041338], [39.103901032801254, 45.0071888596611], [39.086735756607936, 45.01877952070613], [39.0934305506213, 45.02199502369227], [39.093087228037184, 45.024664361009556], [39.077036885871095, 45.029214081612665], [39.0820150668072, 45.03000266316792], [39.08682158640426, 45.03200439844209], [39.088280708795374, 45.025816991015944], [39.09119895242094, 45.03224702748673], [39.10046866849005, 45.03382409599538], [39.10184196007041, 45.036310923635924], [39.09790245160198, 45.036735492596634], [39.094040069505176, 45.0414055485736], [39.10150734074243, 45.04328559363044], [39.10888878162882, 45.043528175597025], [39.116098561195415, 45.04383140161546], [39.114210284576345, 45.039889338321544], [39.12124840197329, 45.04389204637781], [39.12682739773322, 45.04298236453317], [39.12785736574072, 45.04001063662706], [39.12811485748414, 45.03794853084751], [39.12828651831171, 45.03461261451764], [39.129745639380516, 45.031397820693584], [39.13532463429432, 45.03297491187211], [39.13008896150777, 45.02848615385333], [39.12313667665622, 45.02939606561493], [39.1189309731943, 45.0345519596985], [39.11017624168639, 45.033610707080484], [39.11360946836334, 45.02718082530662], [39.117643509129095, 45.02184226283241], [39.10631386002066, 45.02803009627473], [39.10768715082206, 45.02499692795612], [39.10948959452684, 45.01917279535918], [39.11309448209487, 45.01565376216857], [39.1055413822723, 45.020386207541016], [39.09815994232873, 45.02402628462955], [39.09987655603275, 45.01365145628889], [39.10107818536529, 45.009889359409115], [39.106657179269774, 45.00916118314743], [39.08786025832262, 45.02232761071741], [39.1070005056971, 45.00467055537757], [39.110519564089834, 45.00521673149435], [39.11506859073269, 45.00770480140342], [39.1145536064372, 45.00849367910918], [39.11764351172338, 45.008372314015176], [39.116871035620434, 45.00503467336489], [39.115669405676236, 45.00728001660999], [39.11473123467671, 44.99744840498897], [39.1127571297856, 44.9935638477322], [39.12142602670037, 45.00831163064787], [39.119366089247926, 45.01359077867805], [39.12297097781125, 45.0189907841656], [39.12709085151365, 45.02372295556147], [39.134128968545426, 45.01201315311274], [39.14339868201745, 45.01553241106851], [39.14803353923962, 45.01704926606268], [39.090056373016346, 45.00988933705413], [39.08353324000046, 45.01079954475873], [39.08035750420827, 45.010860224761835], [39.072203587601386, 45.01067818454426], [39.06568045449587, 45.00982865591432], [39.06602377799775, 45.006005621546976], [39.07194609577315, 45.00588425120626], [39.07752509079324, 45.00649110033518], [39.0817307943143, 45.00357816602822], [39.07014365156021, 45.00254646635792], [39.07014365200769, 44.997873241666774], [39.079842518813734, 45.000300938315576], [39.07992834895406, 44.99556683481104], [39.071516942926685, 44.99659865984984], [39.066710425850424, 44.99234984954362], [39.07598013787969, 44.991682150780605], [39.06713957896583, 44.99095374329347]]

// Функция для вычисления ближайших точек
function findNeighbors(points, cellSize = 0.015) {
    const result = new Map(); // Итоговый Map для хранения точек и их соседей
    const grid = new Map(); // Сетка для хранения точек по клеткам

    // Преобразование максимальной дистанции в квадрат для оптимизации
    const maxDistanceSquared = cellSize ** 2;

    // Поместить точки в сетку
    points.forEach(([x, y], index) => {
        const cellX = Math.floor((x - 45) / cellSize);
        const cellY = Math.floor((y - 38.9) / cellSize);
        const cellKey = `${cellX},${cellY}`;

        if (!grid.has(cellKey)) grid.set(cellKey, []);
        grid.get(cellKey).push({ index, coords: [x, y] });
    });

    // Функция для вычисления квадратного евклидова расстояния
    function squaredDistance([x1, y1], [x2, y2]) {
        return (x1 - x2) ** 2 + (y1 - y2) ** 2;
    }

    // Поиск ближайших соседей для каждой точки
    points.forEach(([x, y], index) => {
        const neighbors = [];
        const cellX = Math.floor((x - 45) / cellSize);
        const cellY = Math.floor((y - 38.9) / cellSize);

        // Проверяем текущую и соседние клетки (3x3 область)
        for (let dx = -1; dx <= 1; dx++) {
            for (let dy = -1; dy <= 1; dy++) {
                const neighborCellKey = `${cellX + dx},${cellY + dy}`;
                if (grid.has(neighborCellKey)) {
                    grid.get(neighborCellKey).forEach(({ index: neighborIndex, coords: neighborCoords }) => {
                        if (neighborIndex !== index) {
                            const distSquared = squaredDistance([x, y], neighborCoords);
                            if (distSquared <= maxDistanceSquared) {
                                neighbors.push(neighborCoords);
                            }
                        }
                    });
                }
            }
        }

        // Сохраняем соседей в итоговый Map
        result.set([x, y], neighbors);
    });

    return result;
}



// Запуск функции
const neighborsMap = findNeighbors(points);

// Вывод результата
console.log(neighborsMap);


    </script>


</body>

</html>